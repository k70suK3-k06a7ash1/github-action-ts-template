# プロジェクト構成管理ツールの比較

GitHub Actionsテンプレートを作成する際、プロジェクト構成をどう管理するかは重要な選択です。

---

## 1. projen とは

[projen](https://projen.io/) はAWS CDKチームが開発したプロジェクト構成管理ツールです。

```typescript
// .projenrc.ts
import { typescript } from 'projen'

new typescript.TypeScriptProject({
  name: 'my-github-action',
  defaultReleaseBranch: 'main',

  // GitHub Actions用の設定
  githubOptions: {
    mergify: false,
  },

  // 依存関係
  deps: ['@actions/core', '@actions/github'],
  devDeps: ['@vercel/ncc'],

  // npm scripts
  scripts: {
    'build': 'ncc build src/main.ts -o dist',
  },
})
```

**特徴**
- **設定ファイルをコードとして管理**: package.json, tsconfig.json, .gitignore等を自動生成
- **Immutable by design**: 生成ファイルは手動編集不可（`// ~~ Generated by projen`）
- **GitHub Actions用プロジェクトタイプ**: `awscdk.GitHubActionTypeScriptProject` が組み込み
- **依存関係の自動更新**: renovate/dependabot設定も自動生成

---

## 2. プロジェクト構成管理ツール比較

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    プロジェクト構成管理のアプローチ                        │
├─────────────────┬─────────────────┬─────────────────┬───────────────────┤
│  テンプレート    │  ジェネレータ    │  構成管理        │  モノレポ管理      │
│  (Scaffold)     │  (Generator)    │  (Config-as-Code)│  (Monorepo)      │
├─────────────────┼─────────────────┼─────────────────┼───────────────────┤
│ Cookiecutter    │ Yeoman          │ projen          │ Nx               │
│ copier          │ Hygen           │                 │ Turborepo        │
│ degit           │ Plop            │                 │ Lerna            │
│ GitHub Template │ create-*        │                 │ Rush             │
└─────────────────┴─────────────────┴─────────────────┴───────────────────┘
```

| ツール | アプローチ | 言語 | 継続的更新 | 学習コスト | 特徴 |
|--------|------------|------|------------|------------|------|
| **projen** | Config-as-Code | TS | ◎ 自動 | 高 | 設定をコードで定義、自動同期 |
| **Cookiecutter** | テンプレート | Python | × 初回のみ | 低 | Jinja2テンプレート |
| **copier** | テンプレート | Python | ○ 更新可 | 低 | Cookiecutterの進化版 |
| **Yeoman** | ジェネレータ | JS | × | 中 | 対話式、プラグイン豊富 |
| **Hygen** | ジェネレータ | JS | × | 低 | テンプレートベース、高速 |
| **degit** | テンプレート | JS | × | 最低 | GitHubリポジトリをクローン |
| **Nx** | モノレポ | TS | ◎ | 高 | ビルドキャッシュ、依存グラフ |
| **Turborepo** | モノレポ | - | ○ | 中 | 高速ビルド、シンプル |

---

## 3. projen の詳細評価

### メリット

```
✅ 設定ファイルの一元管理
   - package.json, tsconfig.json, .eslintrc, .github/* を自動生成
   - 変更は .projenrc.ts のみで行う

✅ GitHub Actions特化のプロジェクトタイプ
   - awscdk.GitHubActionTypeScriptProject
   - CI/CDワークフローも自動生成

✅ ベストプラクティスの強制
   - 型安全な設定
   - 一貫した構成

✅ 依存関係の自動更新
   - renovate/dependabot設定
   - 自動マージ設定も可能
```

### デメリット

```
❌ 学習コスト
   - projen独自の概念を理解する必要がある
   - ドキュメントが限定的

❌ 柔軟性の制限
   - 生成ファイルは手動編集不可
   - カスタマイズにはprojenの理解が必要

❌ 依存関係
   - projen自体が依存として追加される
   - 小規模プロジェクトにはオーバーヘッド

❌ エコシステムの成熟度
   - AWS/CDK以外のコミュニティは小さい
```

---

## 4. GitHub Actions + projen の例

```typescript
// .projenrc.ts
import { awscdk } from 'projen'

new awscdk.GitHubActionTypeScriptProject({
  name: 'my-action',
  defaultReleaseBranch: 'main',

  actionMetadata: {
    name: 'My Action',
    description: 'Description of my action',
    inputs: {
      'example-input': {
        description: 'An example input',
        required: false,
        default: 'default value',
      },
    },
    outputs: {
      'example-output': {
        description: 'An example output',
      },
    },
    runs: {
      using: 'node20',
      main: 'dist/index.js',
    },
  },
})
```

**自動生成されるファイル**
```
├── .github/
│   ├── workflows/
│   │   ├── build.yml
│   │   ├── release.yml
│   │   └── upgrade.yml
│   └── dependabot.yml
├── .eslintrc.json
├── .gitignore
├── .prettierrc.json
├── action.yml          ← actionMetadataから生成
├── package.json
├── tsconfig.json
└── src/
    └── index.ts
```

---

## 5. 各アプローチの使い分け

### 判断フローチャート

```
プロジェクトの規模は？
├─ 大規模/長期運用
│   └─ 設定の一貫性が重要？
│       ├─ Yes → projen ✓
│       └─ No  → モノレポなら Nx/Turborepo
│
├─ 中規模
│   └─ テンプレートの更新を追従したい？
│       ├─ Yes → copier
│       └─ No  → Hygen / create-*
│
└─ 小規模/一回きり
    └─ 手動テンプレート or degit
```

### ユースケース別推奨

| ユースケース | 推奨ツール | 理由 |
|--------------|------------|------|
| 個人の小規模Action | **手動/degit** | オーバーヘッドなし |
| チームで複数Action管理 | **projen** | 設定の一貫性、自動更新 |
| 社内テンプレート配布 | **copier** | 継続的な更新が可能 |
| モノレポ内のAction | **Nx** | 依存グラフ、キャッシュ |
| 対話式セットアップ | **Yeoman/Hygen** | ユーザー入力でカスタマイズ |

---

## 6. 本テンプレートが手動構成を選んだ理由

### 採用しなかった理由

| ツール | 不採用理由 |
|--------|------------|
| **projen** | 学習コストが高い、小規模には過剰、依存が増える |
| **Nx/Turborepo** | 単一Actionにはオーバーヘッド |
| **Yeoman** | メンテナンスが停滞気味 |
| **copier** | Python依存、Node.jsプロジェクトには不自然 |

### 手動構成のメリット

1. **透明性**: 全ファイルが直接編集可能
2. **依存なし**: projen等の追加依存不要
3. **学習コスト低**: 標準的なNode.js構成
4. **柔軟性**: 自由にカスタマイズ可能

### projenを採用すべきケース

- 複数のGitHub Actionsを管理している
- 設定の一貫性を強制したい
- 依存関係の自動更新を行いたい
- AWS CDKと併用している

---

## 7. projenへの移行方法

既存プロジェクトをprojenに移行する場合：

```bash
# 1. projenをインストール
npm install -D projen

# 2. 初期化
npx projen new awscdk-githubaction-ts

# 3. .projenrc.ts を編集

# 4. 設定を反映
npx projen
```

**注意**: 既存の設定ファイルは上書きされます。

---

## 8. 比較まとめ

```
                    自動化・一貫性
                         ↑
                         │
              projen ●   │
                         │
                         │
    ──────────────────────┼─────────────────────→ シンプルさ
                         │
                         │
         copier ●        │        ● 手動テンプレート（本テンプレート）
                         │
         Hygen ●         │        ● degit
                         │
                         ↓
                    柔軟性・透明性
```

| 観点 | 手動構成 | projen |
|------|----------|--------|
| 学習コスト | ◎ 低 | △ 高 |
| 柔軟性 | ◎ 高 | ○ 中 |
| 一貫性 | △ 人依存 | ◎ 自動 |
| 保守性 | ○ | ◎ 自動更新 |
| 依存 | ◎ なし | △ projen必須 |
| スケール | △ 手動 | ◎ 複数プロジェクト |

---

## 結論

**本テンプレートの選択**: 手動構成

- シンプルさ・透明性を重視
- 単一Actionのテンプレートとして最適
- 利用者が自由にカスタマイズ可能

**projenを検討すべき場合**:
- 組織で複数のActionsを管理
- 設定の自動更新・一貫性が重要
- AWS CDK経験者がいる
